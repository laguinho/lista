"use strict";function __render(a,t){if(!$templates[a])return!1;var e=$templates[a].clone();return e.data(t),$.fn.fillBlanks=function(){for(var a=$(this),e=a.data("fill"),o=e.split(","),i=0;i<o.length;i++){var n=o[i].split(":"),s=n[1]?n[0].trim():"html",r=n[1]?n[1].trim():n[0],l=t[r];if("undefined"!=typeof l&&null!==l)"class"===s?a.addClass(l):"html"===s?a.html(l):"value"===s?a.val(l):a.attr(s,l);else{var d=a.data("fill-null");"hide"===d?a.hide():"remove"===d&&a.remove()}}a.removeClass("fill").removeAttr("data-fill").removeAttr("data-fill-null")},e.hasClass("fill")&&e.fillBlanks(),$(".fill",e).each(function(){$(this).fillBlanks()}),e}function setLayoutProperties(){UI.data.window.width=$ui.window.width(),UI.data.window.height=$ui.window.height(),UI.data.columns=Math.floor(UI.data.window.width/UI.data["column-width"]);var a=void 0;a=1===UI.data.columns?"ui-single-column":2===UI.data.columns?"ui-dual-column":"ui-multi-column",$ui.body.removeClass("ui-single-column ui-dual-column ui-multi-column").addClass(a)}function getScrollbarSize(){var a=$("<div />").css({overflow:"scroll",display:"none"}).appendTo($ui.body),t=$("<div />").appendTo(a);UI.data["scrollbar-size"]=a.width()-t.width(),a.remove()}function setScrollPosition(){UI.data["scroll-position"].top=$ui.window.scrollTop(),UI.data["scroll-position"].bottom=UI.data["scroll-position"].top+UI.data.window.height}function upload(a){var t={0:0,1:0,2:0,3:180,4:0,5:0,6:90,7:0,8:270};FileAPI.filterFiles(a,function(a,t){return!!/^image/.test(a.type)&&(file_stack[a.name]=t,!0)},function(a,e){a.length&&($(".submit",$app.post).addClass("disabled"),FileAPI.each(a,function(a){var e=file_stack[a.name].exif.Orientation;if(file_stack[a.name].ref=tarefa_active+"-"+Lista.Usuario.id+"-"+moment().format("X")+"-"+rand(0,999).toFixed(0),"image/gif"==a.type){var o=new FileReader;o.onload=function(t){var e=$("<img />").attr("src",t.target.result),o=$('<input type="hidden" name="image-order[]" />').val(file_stack[a.name].ref),i=$("<div />").addClass("progress");$("<div />").addClass("status").html("<strong>Enviando&hellip;</strong>").appendTo(i),$("<div />").addClass("bar").appendTo(i);var n=$("<li />").attr("id","file-"+file_stack[a.name].ref).append(o).append(i).append(e);$("#dropzone #board").append(n)},o.readAsDataURL(a)}else FileAPI.Image(a).rotate(t[e]).resize(600,300,"preview").get(function(t,e){var o=$('<input type="hidden" name="image-order[]" />').val(file_stack[a.name].ref),i=$("<div />").addClass("progress");$("<div />").addClass("status").html("<strong>Enviando&hellip;</strong>").appendTo(i),$("<div />").addClass("bar").appendTo(i);var n=$("<li />").attr("id","file-"+file_stack[a.name].ref).append(o).append(i).append(e);$("#dropzone #board").append(n)})}),FileAPI.upload({url:"/tarefas/"+tarefa_active+"/postar",data:{action:"upload",edicao:Lista.Edicao.titulo,tarefa:tarefa_active,turma:Lista.Usuario.turma,user:Lista.Usuario.id},prepare:function(a,t){t.data.ref=file_stack[a.name].ref,a.ref=file_stack[a.name].ref},imageAutoOrientation:"image/gif"!==a[0].type||null,imageTransform:"image/gif"!==a[0].type?{maxWidth:1920,maxHeight:1920}:null,files:a,fileprogress:function(a,t,e){var o=(a.loaded/a.total*100).toFixed(0),i=o<100?"<strong>Enviando&hellip;</strong> "+o+"%":"<strong>Processando&hellip;</strong>";$("#file-"+t.ref+" .status","#dropzone").html(i)},progress:function(a){},filecomplete:function(a,t,e){$("#file-"+e.ref+" .status","#dropzone").html('<i class="material-icons">check</i>')},complete:function(a,t){app.Post.authorize()}}))})}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},Lista=[];Lista.Edicao={},Lista.Placar=[],Lista.Tarefas=[],Lista.Usuario={};var app=[],$app=[],cache=[];cache.tarefas=[];var cue=[],worker=[],timing=[],logging=!1,log=function(a,t){if(logging){var e=moment().format("LTS");a="["+e+"] "+a,t?console[t](a):console.log(a)}},analytics=function(a,t,e){"undefined"!=typeof ga&&ga("send","event",a,t,e)},tarefa_active,rand=function(a,t){return Math.random()*(t-a)+a},$templates={};$(function(){$("template").each(function(){var a=$(this),t=a.attr("id"),e=a.html();$templates[t]=$(e),a.remove()})});var router=[];router.path=location.pathname.split("/"),"tarefas"===router.path[1]?router["navigation-mode"]="path":(router["navigation-mode"]="hash",router.path=location.hash.split("/")),router.go=function(a,t,e){"path"===router["navigation-mode"]?history.pushState(t,e,a):history.pushState(t,e,"#"+a)},router["build-link"]=function(a){var t;return t="path"===router["navigation-mode"]?a:"#"+a},router["current-view"]=["home"],router["view-manager"]=function(){return{add:function(a){router["current-view"].push(a)},remove:function(a){router["current-view"]=$.grep(router["current-view"],function(t){return t!==a})},replace:function(a){router["current-view"]=[],router["view-manager"].add(a)}}}(),window.addEventListener("popstate",function(a){var t=a.state;t&&"tarefa"===t.view?(router["current-view"].indexOf("bottomsheet")>-1&&UI.bottomsheet.close(),router["current-view"].indexOf("new-post")>-1&&app.Post.close(),app.Tarefa.open(t.id)):t&&"new-post"===t.view||(t&&"bottomsheet"===t.view?router["current-view"].indexOf("new-post")>-1&&app.Post.close():(router["current-view"].indexOf("bottomsheet")>-1&&UI.bottomsheet.close(),router["current-view"].indexOf("new-post")>-1&&app.Post.close(),app.Tarefa.close()))});var UI={};UI.data=[];var $ui=[];$ui.window=$(window),$ui.body=$(document.body),$ui["page-title"]=$("head title"),UI.data["page-title"]=$ui["page-title"].text(),$.fn.reflow=function(){$ui.body.offset().left;return $(this)},UI.data["theme-color"]=[],$(function(){$ui.title=$("head title"),UI.data.title=$ui.title.html(),$ui["theme-color"]=$("meta[name='theme-color']"),UI.data["theme-color"].original=$ui["theme-color"].attr("content")}),UI.data["interaction-type"]="ontouchstart"in window||navigator.msMaxTouchPoints?"touch":"pointer",UI.data["column-width"]=316,UI.data.window=[],$(function(){setLayoutProperties(),getScrollbarSize()}),$ui.window.on("resize",setLayoutProperties),UI.data["scroll-position"]=[],$(function(){setScrollPosition()}),$ui.window.on("scroll resize",setScrollPosition),UI.body=function(){function a(){var a=$(window).scrollTop();a>1?$ui.body.removeClass("scroll-top"):$ui.body.addClass("scroll-top"),a>56?$ui.body.addClass("livesite-blur").removeClass("livesite-focus"):$ui.body.addClass("livesite-focus").removeClass("livesite-blur")}return $(function(){$ui.body.addClass("ui-"+UI.data["interaction-type"]),a()}),$ui.window.on("scroll",a),{lock:function(){$ui.body.addClass("no-scroll").css("margin-right",UI.data["scrollbar-size"])},unlock:function(){$ui.body.removeClass("no-scroll").css("margin-right",0)}}}(),UI.loadbar=function(){return $(function(){$ui.loadbar=$(".ui-loadbar")}),{show:function(){$ui.loadbar.addClass("in")},hide:function(){timing["hide-loadbar"]=setTimeout(function(){$ui.loadbar.removeClass("fade-in").one("transitionend",function(){$ui.loadbar.removeClass("in")})},800)}}}(),UI.backdrop=function(){return $ui.backdrop=[],$(function(){}),{show:function(a,t){var e=a.selector,o=a.css("z-index")-1;$ui.backdrop[e]=__render("backdrop"),$.each(t,function(a,t){$ui.backdrop[e].on(a,t)}),$ui.backdrop[e].css("z-index",o).on("click",function(){$(this).trigger("hide")}).appendTo($ui.body).addClass("in")},hide:function(a){var t=a.selector;$ui.backdrop[t].removeClass("in").off("hide").remove()}}}(),UI.sidenav=function(){return $(function(){$ui.sidenav=$(".js-ui-sidenav"),$(".js-sidenav-trigger").on("click",function(a){a.preventDefault(),UI.sidenav.open()})}),{open:function(){UI.body.lock(),UI.backdrop.show($ui.sidenav,{hide:UI.sidenav.close}),$ui.sidenav.addClass("in")},close:function(){$ui.sidenav.removeClass("in"),UI.backdrop.hide($ui.sidenav),UI.body.unlock()}}}(),UI.bottomsheet=function(){return{open:function(a,t){UI.backdrop.show($ui.bottomsheet,{hide:UI.bottomsheet.close}),$ui.bottomsheet.html(a).addClass((t?t+" ":"")+"in").reflow().addClass("slide"),UI.data["theme-color"].buffer=$ui["theme-color"].attr("content"),$ui["theme-color"].attr("content","#000"),router["view-manager"].add("bottomsheet"),history.pushState({view:"bottomsheet"},null,null)},close:function(){$ui.bottomsheet.removeClass("slide").one("transitionend",function(){$ui.bottomsheet.removeClass("in").empty().attr("class","ui-bottomsheet js-ui-bottomsheet")}),$ui["theme-color"].attr("content",UI.data["theme-color"].buffer),UI.backdrop.hide($ui.bottomsheet),router["view-manager"].remove("bottomsheet")}}}(),$(function(){$ui.bottomsheet=$(".js-ui-bottomsheet")}),UI.toast=function(){return $ui.toast=[],$(function(){$ui.toast=$(".js-ui-toast"),$ui.toast.message=$(".toast-message",$ui.toast),$ui.toast.label=$(".toast-label",$ui.toast)}),{show:function(a){log("UI.toast.show"),"object"===("undefined"==typeof a?"undefined":_typeof(a))?($ui.toast.removeClass("start-only"),$ui.toast.message.html(a.message||""),a.label&&a.action?$ui.toast.label.html(a.label).off("click").on("click",a.action).show():$ui.toast.label.hide(),$ui.toast.addClass("in").reflow().addClass("slide"),$ui.body.addClass("toast-active"),$ui.toast.on("click",UI.toast.dismiss),clearTimeout(timing.toast),a.persistent||(timing.toast=setTimeout(UI.toast.dismiss,a.timeout?a.timeout:6e3)),a["start-only"]&&$ui.toast.addClass("start-only")):UI.toast.show({message:a})},dismiss:function(){log("UI.toast.dismiss"),$ui.toast.removeClass("slide").one("transitionend",function(){$ui.body.removeClass("toast-active"),$ui.toast.removeClass("in start-only"),$ui.toast.message.empty(),$ui.toast.label.empty()}),clearTimeout(timing.toast)},open:function(a,t,e,o){$ui.toast.message.html(a),$ui.toast.label.html(t?t:""),$ui.toast.addClass("in").reflow().addClass("slide"),$ui.body.addClass("toast-active"),$ui.toast.on("click",UI.toast.dismiss),$ui.toast.label.on("click",e),clearTimeout(timing.toast),o?$ui.toast.addClass("start-only"):($ui.toast.removeClass("start-only"),timing["toast-open"]=setTimeout(UI.toast.dismiss,6500))}}}();var api_key="063c72b2afc5333f3b27b366bdac9eb81d64bc6a12cd7b3f4b6ade77a092b63a",ListaAPI=function(a,t){log("API Request: "+a,"info");var e="https://api.laguinho.org/lista/"+edicao,o="063c72b2afc5333f3b27b366bdac9eb81d64bc6a12cd7b3f4b6ade77a092b63a",i=$.getJSON(e+a+"?key="+o+"&callback=?",t);return i};app.Placar=function(){return $(function(){$ui.placar=$(".js-app-placar ul")}),{start:function(){},update:function(){$ui.placar.empty();var a=0,t=0;Lista.Placar.forEach(function(e){var o=e.pontos;o>a&&(a=o),t+=o}),Lista.Placar.forEach(function(e){var o=t>0?e.pontos/a:0;e["turma-formatada"]=e.turma.toUpperCase(),e["tamanho-da-barra"]="height: "+(100*o).toFixed(3)+"%;",e["pontuacao-formatada"]=e.pontos.toString().replace(/\B(?=(\d{3})+(?!\d))/g,".");var i=__render("placar-turma",e);$ui.placar.append(i)}),0===t?$ui.placar.addClass("placar-zerado"):$ui.placar.removeClass("placar-zerado")}}}(),app.Evolucao=function(){var a=void 0;return $(function(){$ui.evolucao=$(".app-evolucao")}),{start:function(){log("app.Evolucao.start","info");var t=Lista.Edicao.inicio=moment(Lista.Edicao.inicio),e=Lista.Edicao.fim=moment(Lista.Edicao.fim);a=e.diff(t,"minutes");for(var o=t.clone();o.isBefore(e);o.add(1,"days")){var i=o,n=o.clone().endOf("day");n.isAfter(e)&&(n=e);var s=n.diff(i,"minutes"),r=s/a,l=(100*r).toFixed(3),d=__render("evolucao-dia",{dia:o.format("ddd")}).css("width",l+"%");$(".day-labels",$ui.evolucao).append(d)}setTimeout(app.Evolucao.update,1e3),timing.evolucao=setInterval(app.Evolucao.update,6e4)},update:function(){log("app.Evolucao.update","info");var t=moment(),e=moment(Lista.Edicao.inicio),o=(moment(Lista.Edicao.fim),t.diff(e,"minutes")),i=o<a?o/a:1;$(".elapsed-time .bar",$ui.evolucao).css("width",UI.data.window.width);var n=(100*i).toFixed(3);$(".elapsed-time",$ui.evolucao).css("width",n+"%")}}}(),app.Lista=function(){return $(function(){$app.lista=$(".app-lista"),$app.lista.isotope({itemSelector:".card-tarefa",transitionDuration:".8s",getSortData:{date:function(a){return $(a).data("last-modified")},tarefa:function(a){return parseInt($(a).data("tarefa"),10)}},sortAscending:{date:!1,tarefa:!0},sortBy:["date","tarefa"],masonry:{gutter:1===UI.data.columns?8:16}}),$app.lista.on("click",".card-tarefa:not(.fantasma)",function(a){if(1===a.which){a.preventDefault();var t=$(this),e=t.data("tarefa");app.Tarefa.open(e,t,!0)}})}),{start:function(){log("app.Lista.start","info"),app.Lista.tarefas(),app.Lista.status(),app.Lista.messages(),UI.loadbar.hide()},status:function(){moment().isAfter(Lista.Edicao.fim)&&$ui.body.addClass("postagens-encerradas"),Lista.Edicao.encerrada===!0&&($ui.body.addClass("edicao-encerrada"),clearInterval(timing.atividade))},messages:function(){if(Lista.Edicao.mensagem.titulo){var a=Lista.Edicao.mensagem.titulo;$ui.title.html(a)}if(Lista.Edicao.mensagem.rodape){var t=Lista.Edicao.mensagem.rodape;$(".js-mensagem-final").html(t)}},tarefas:function(){$app.lista.empty();var a=!0,t=!1,e=void 0;try{for(var o,i=Lista.Tarefas[Symbol.iterator]();!(a=(o=i.next()).done);a=!0){var n=o.value;cache.tarefas[n.numero]=n,n.url=router["build-link"]("/tarefas/"+n.numero),n.imagem&&(n["imagem/url"]=n.imagem.url,n["imagem/aspecto"]="padding-top: "+(100*n.imagem.aspecto).toFixed(2)+"%");var s=__render("card-tarefa",n).data({tarefa:n.numero,"last-modified":n["ultima-postagem"]?moment(n["ultima-postagem"]).format("X"):0}),r=$(".tarefa-conteudo .grid",s);if(n["quantidade-de-posts"]&&n.posts){for(var l=8,d=0,u=["imagem","youtube","vimeo","vine","gif"],c=["texto"],p=0;p<l;p++)if(n.posts[p]){var m=n.posts[p];if(m.midia||"texto"==m.tipo){d++;var f,v={};u.indexOf(m.tipo)>-1?(f="tile-image",v.count=d,"youtube"==m.tipo||"vimeo"==m.tipo||"vine"==m.tipo||"gif"==m.tipo?(v.preview="background-image: url('"+m.midia[0].thumbnail+"');",v.modifier="video"):m.midia&&m.midia[0]&&(v.preview="background-image: url('"+m.midia[0].caminho+m.midia[0].arquivos[0]+"');")):c.indexOf(m.tipo)>-1&&(f="tile-text",v={preview:m.legenda.substring(0,120),count:d}),d===l&&n["quantidade-de-posts"]-d>0&&(v.modifier="more",v.more="+&thinsp;"+(n["quantidade-de-posts"]-d+1));__render(f,v).appendTo(r)}}}else $(".tarefa-conteudo",s).remove();n.preview&&(s.addClass("fantasma"),$("a",s).removeAttr("href"),$(".tarefa-corpo",s).remove()),$app.lista.append(s).isotope("appended",s)}}catch(a){t=!0,e=a}finally{try{!a&&i.return&&i.return()}finally{if(t)throw e}}app.Lista.layout(),app.Lista.sort(Lista.Edicao.encerrada?"tarefa":"date")},layout:function(){$app.lista.isotope("reloadItems"),$app.lista.isotope("layout")},sort:function(a){$app.lista.isotope({sortBy:a})}}}();var $stream;$(function(){$stream=$(".js-app-lista"),$stream.isotope({itemSelector:".card-tarefa",transitionDuration:".8s",getSortData:{date:".last-modified",tarefa:function(a){return parseInt($(a).data("tarefa"),10)}},sortAscending:{date:!1,tarefa:!0},sortBy:["date","tarefa"],masonry:{gutter:1===UI.data.columns?8:16}}),$ui.sidenav.on("click",".js-lista-sort a",function(a){a.preventDefault();var t=$(this).data("sort-by"),e=$(this).find("span").text();$(".js-lista-sort a",$ui.sidenav).removeClass("active"),$(this).addClass("active"),app.Lista.sort(t),UI.sidenav.close(),analytics("Lista","Ordenação",e)})}),app.Tarefa=function(){function a(a,e){t.total=0;for(var o in Lista.Edicao.turmas)t[Lista.Edicao.turmas[o]]=0;$.each(a,function(a,o){o["turma-background"]=o.turma+"-light-background",o["data-de-postagem-formatada"]=moment(o["data-de-postagem"]).calendar(),o["turma-formatada"]=o.turma.toUpperCase(),o.legenda&&"<p>"!==o.legenda.substring(0,3)&&(o.legenda="<p>"+o.legenda.replace(/(?:\r\n\r\n|\r\r|\n\n)/g,"</p><p>")+"</p>"),o.avaliacao?(o["avaliacao/mensagem"]=o.avaliacao.mensagem,200===o.avaliacao.status?(o["status-class"]=o.turma,o["status-icon"]='<i class="material-icons">&#xE87D;</i>',o["avaliacao/status"]=o.avaliacao.pontos+" ponto"+(o.avaliacao.pontos>1?"s":""),o["avaliacao/class"]="turma-text"):(o["status-class"]="rejected",o["status-icon"]='<i class="material-icons">&#xE888;</i>',o["avaliacao/status"]="Reprovado"),t.total+=o.avaliacao.pontos,t[o.turma]+=o.avaliacao.pontos):(o["status-icon"]='<i class="material-icons">&#xE8B5;</i>',o["avaliacao/status"]="Aguardando avaliação");var i=__render("content-card",o),n=$(".content-media > ul",i);o.midia&&$.each(o.midia,function(a,t){if("imagem"==o.tipo){t.default=t.caminho+t.arquivos[1],t["padding-aspecto"]="padding-top: "+(100*t.aspecto).toFixed(2)+"%",t["link-original"]=t.caminho+t.arquivos[2];var e=__render("media-photo",t);n.append(e)}else if("youtube"==o.tipo||"vimeo"==o.tipo||"vine"==o.tipo){"youtube"==o.tipo?t.embed="https://www.youtube.com/embed/"+t["youtube-id"]+"?rel=0&amp;showinfo=0":"vimeo"==o.tipo?t.embed="https://player.vimeo.com/video/"+t["vimeo-id"]+"?title=0&byline=0&portrait=0":"vine"==o.tipo&&(t.embed="https://vine.co/v/"+t["vine-id"]+"/embed/simple"),t["padding-aspecto"]="padding-top: "+(100*t.aspecto).toFixed(2)+"%";var i=__render("media-video",t);n.append(i)}}),o.legenda||i.addClass("no-caption"),o.midia||i.addClass("no-media"),o.avaliacao&&o.mensagem||$(".result .message",i).remove(),e.append(i)})}$(function(){$app.tarefa=$(".app-tarefa"),$app.tarefa.on("click",".js-tarefa-close",function(a){a.preventDefault(),app.Tarefa.close(!0)}).on("click",".js-new-post-trigger",function(){UI.bottomsheet.open($(".new-post-sheet",$app.tarefa).clone().show())}).on("click",".card-tarefa a",function(a){1===a.which&&a.preventDefault()})});var t=[];return{data:{},open:function(a,t,e){var o=cache.tarefas[a];tarefa_active=a,$app.tarefa.addClass("in"),app.Tarefa.render(o),$app.tarefa.reflow().addClass("slide-x").one("transitionend",function(){}),UI.body.lock(),$ui.body.addClass("tarefa-active"),router["view-manager"].replace("tarefa"),e&&router.go("/tarefas/"+o.numero,{view:"tarefa",id:o.numero},o.titulo),analytics("Tarefa","Acesso",a)},render:function(t){var e=__render("view-tarefa",t);t.imagem&&(t.imagem.aspecto="padding-top: "+(100*t.imagem.aspecto).toFixed(2)+"%");var o=__render("card-tarefa",t);t.imagem||$(".media",o).remove(),$(".grid",o).remove(),$("a",o).removeAttr("href"),$(".tarefa-meta .tarefa-texto",e).append(o);var i=$(".tarefa-content > ul",e);t.posts.length?(a(t.posts,i),i.isotope({itemSelector:".content-card",transitionDuration:0,masonry:{isFitWidth:!0,gutter:1===UI.data.columns?8:24}}),setTimeout(function(){i.isotope("layout")},1)):$("<li />").addClass("empty").text("Nenhum post").appendTo(i),$app.tarefa.html(e),t.posts.length&&i.isotope("layout"),$(".tarefa-wrapper",$app.tarefa).on("scroll",app.Tarefa.observer)},close:function(a){tarefa_active=null,$("head meta[name='theme-color']").attr("content",UI.data["theme-color"].original),UI.body.unlock(),$ui.body.removeClass("tarefa-active"),$app.tarefa.removeClass("slide-x").one("transitionend",function(){$app.tarefa.removeClass("in").empty()}),UI.data.columns>=3,router["view-manager"].replace("home"),a&&router.go("/tarefas",{view:"home"},"Lista de Tarefas")},observer:function(){app.Tarefa.data.height=$(".tarefa-outer-container",$app.tarefa).outerHeight(),app.Tarefa.data.scrollYpos=$(".tarefa-wrapper",$app.tarefa).scrollTop(),console.log(app.Tarefa.data)}}}(),app.Post=function(){return $(function(){$app.post=$(".app-post"),$ui.bottomsheet.on("click",".new-post-sheet a",function(a){a.preventDefault();var t=$(this).data("post-type");UI.bottomsheet.close(),setTimeout(function(){app.Post.open(t,tarefa_active)},600)}),$app.post.on("submit","form",function(a){a.preventDefault()}).on("click",".submit-button",function(a){if(a.preventDefault(),moment().isAfter(Lista.Edicao.fim)&&UI.toast.open("Postagens encerradas!"),$(this).hasClass("disabled"))return void UI.toast.open("Espere o fim do upload&hellip;");var t=$("form",$app.post).serialize();$(".submit-button",$app.post).addClass("disabled").html("Enviando&hellip;"),$.post("/tarefas/"+tarefa_active+"/postar",t).done(function(a){analytics("Conteúdo","Tentativa"),200===a.meta.status?(app.Post.close(),app.Tarefa.render(a.data),UI.toast.open(a.meta.message),navigator.vibrate(800),Lista.Tarefas[a.data.numero]=a.data,analytics("Conteúdo","Postagem")):(UI.toast.open(a.meta.message?a.meta.message:"Ocorreu um erro. Tente novamente"),analytics("Conteúdo","Erro"))}).fail(function(){UI.toast.open("Ocorreu um erro. Tente novamente",null,null,!1),analytics("Conteúdo","Erro")})}).on("click",".back-button",function(a){a.preventDefault(),app.Post.close()})}),{authorize:function(){$(".submit-button",$app.post).removeClass("disabled")},deauthorize:function(){$(".submit-button",$app.post).addClass("disabled")},getThumbnail:function(a){function t(a){var t=$("<img />").attr("src",a.thumbnail);$(".js-media-provider",$app.post).val(a.provider),$(".js-media-id",$app.post).val(a.id),$(".js-media-thumbnail",$app.post).val(a.thumbnail),$(".js-media-preview",$app.post).html(t).fadeIn()}var e={};if(a.match(/(?:https?:\/{2})?(?:w{3}\.)?youtu(?:be)?\.(?:com|be)(?:\/watch\?v=|\/)([^\s&]+)/)){var o=a.match(/(?:https?:\/{2})?(?:w{3}\.)?youtu(?:be)?\.(?:com|be)(?:\/watch\?v=|\/)([^\s&]+)/);e.provider="youtube",e.id=o[1],e.thumbnail="https://i1.ytimg.com/vi/"+o[1]+"/0.jpg",app.Post.authorize(),t(e)}else if(a.match(/vimeo\.com/)){var i=a.match(/\/\/(www\.)?vimeo.com\/(\d+)($|\/)/);e.provider="vimeo",e.id=i[2],$.getJSON("https://vimeo.com/api/v2/video/"+i[2]+".json?callback=?").done(function(a){e.thumbnail=a[0].thumbnail_large,app.Post.authorize(),t(e)})}},open:function(a,t){var e={edicao:Lista.Edicao.titulo,numero:t||tarefa_active,user:Lista.Usuario.id,turma:Lista.Usuario.turma,token:Lista.Usuario.token},o=__render("new-post-"+a,e);$app.post.html(o).addClass("in").reflow().addClass("slide-y").one("transitionend",function(){var a=$(".appbar",$app.post).css("background-color");$("head meta[name='theme-color']").attr("content",a)}),app.Post.deauthorize(),"photo"===a?($app.post.dropzone(),$(".file-placeholder",$app.post).trigger("click")):"video"===a||"vine"===a?$(".js-media-url-input",$app.post).focus().on("keyup",function(){app.Post.getThumbnail($(this).val())}):"text"===a&&$(".js-caption-input",$app.post).focus().on("keyup",function(){$(this).val().length>0?app.Post.authorize():app.Post.deauthorize()}),UI.backdrop.show($app.post),router["view-manager"].replace("new-post"),history.replaceState({view:"new-post",type:a,id:e.numero},null,null)},close:function(){$("head meta[name='theme-color']").attr("content",UI.data["theme-color"].original),$app.post.removeClass("slide-y").one("transitionend",function(){$app.post.removeClass("in").empty(),UI.backdrop.hide($app.post)}),router["view-manager"].replace("tarefa")}}}();var file_stack={};$.fn.dropzone=function(){var a=$("#dropzone",this);FileAPI.event.dnd(a[0],function(t){t?a.addClass("active"):a.removeClass("active")},function(a){upload(a)});var t=document.getElementById("form-file");FileAPI.event.on(t,"change",function(a){var t=FileAPI.getFiles(a);upload(t)});var e=$("#board",this);e.on("slip:beforewait",function(a){"pointer"===UI.data["interaction-type"]&&a.preventDefault()}).on("slip:afterswipe",function(a){a.target.remove()}).on("slip:reorder",function(a){return a=a.originalEvent,a.target.parentNode.insertBefore(a.target,a.detail.insertBefore),!1}),new Slip(e[0])},app.Login=function(){return Lista.Usuario={id:null,name:null,email:null,token:null,turma:null,"signed-in":!1},localStorage&&localStorage.getItem("Lista.Usuario")&&(Lista.Usuario=JSON.parse(localStorage.getItem("Lista.Usuario")),$(function(){null!==Lista.Usuario.id&&($ui.body.addClass("signed-in user-"+Lista.Usuario.turma),cue["load-edicao"].done(function(){setTimeout(function(){UI.toast.show("Olá "+Lista.Usuario.name+"!")},3e3)}))})),$(function(){$ui.login=$(".app-login"),$ui.login.button=$(".js-login-button",$ui.login),$(".js-login-trigger",$ui.sidenav).on("click",function(a){a.preventDefault(),UI.sidenav.close(),app.Login.show()}),$(".js-logout-trigger",$ui.sidenav).on("click",function(a){a.preventDefault(),UI.sidenav.close(),app.Login.logout()}),$ui.login.on("click",".back-button",function(a){a.preventDefault(),app.Login.hide()}).on("submit","form",function(a){a.preventDefault(),$(".js-login-button",$ui.form).trigger("click");var t=$("form",$ui.login).serialize();app.Login.submit(t)})}),{show:function(){$ui.login.addClass("in").reflow().addClass("slide").one("transitionend",function(){UI.body.lock(),UI.backdrop.show($ui.login),$("input[name='email']",$ui.login).focus()})},hide:function(){$ui.login.removeClass("slide").one("transitionend",function(){$ui.login.removeClass("in"),UI.backdrop.hide($ui.login),UI.body.unlock()})},submit:function(a){$ui.login.button.prop("disabled",!0).text("Aguarde…"),ListaAPI("/identificacao",a).done(function(a){200===a.meta.status?(Lista.Usuario=a.user,Lista.Usuario["signed-in"]=!0,localStorage.setItem("Lista.Usuario",JSON.stringify(Lista.Usuario)),$ui.body.addClass("signed-in user-"+Lista.Usuario.turma),app.Login.hide(),setTimeout(function(){UI.toast.show("Olá "+Lista.Usuario.name+"!")},500),analytics("Login","Acesso")):($(".form-group",$ui.login).addClass("animated shake"),setTimeout(function(){$(".form-group",$ui.login).removeClass("animated shake")},1e3),analytics("Login","Erro"))}).fail(function(){UI.toast.show("Ocorreu um erro. Tente novamente"),analytics("Login","Erro")}).always(function(){$ui.login.button.prop("disabled",!1).text("Login"),analytics("Login","Tentativa")})},logout:function(){$ui.body.removeClass("signed-in user-"+Lista.Usuario.turma),Lista.Usuario={id:null,name:null,email:null,token:null,turma:null,"signed-in":!1},localStorage.setItem("Lista.Usuario",JSON.stringify(Lista.Usuario)),setTimeout(function(){UI.toast.show("Sessão encerrada!")},500),analytics("Login","Logout")}}}(),worker.Start=function(){timing["delay-start"]=setTimeout(function(){log("worker.Start","info"),cue["load-edicao"]=$.Deferred(),cue["first-load"]=!0,cue["load-edicao"].done(function(){if(router.path&&router.path[2]){var a=router.path[2];!isNaN(a)&&a>=1&&a<=Lista.Edicao["numero-de-tarefas"]&&app.Tarefa.open(a,!1,!1)}cue["first-load"]&&(timing["delay-evolucao"]=setTimeout(app.Evolucao.start,100),worker.Update(),cue["first-load"]=!1)}),timing["delay-load"]=setTimeout(function(){worker.Load()},300),analytics("Lista","Acesso")},0)}(),worker.Load=function(){log("worker.Load","info"),ListaAPI("/tudo").done(function(a){Lista.Edicao=a.edicao,Lista.Placar=a.placar,Lista.Tarefas=a.tarefas,timing["delay-lista"]=setTimeout(function(){app.Lista.start(),app.Placar.update(),cue["load-edicao"].resolve(),log('cue["load-edicao"] triggered')},1)})},worker.Update=function(){var a={tarefas:0,posts:0,total:0,"last-updated":null};timing.atividade=setInterval(function(){log("worker.Update","info"),ListaAPI("/atividade").done(function(t){var e=!0,o=!1,i=void 0;try{for(var n,s=t[Symbol.iterator]();!(e=(n=s.next()).done);e=!0){var r=n.value;moment(r.ts).isAfter(a["last-updated"])&&r.autor!=Lista.Usuario.id&&(a.total++,"nova-tarefa"===r.acao?a.tarefas++:"novo-post"===r.acao&&a.posts++)}}catch(a){o=!0,i=a}finally{try{!e&&s.return&&s.return()}finally{if(o)throw i}}if(a.total>0){var l={tarefas:a.tarefas+" "+(a.tarefas>1?"novas tarefas":"nova tarefa"),posts:a.posts+" "+(a.posts>1?"novos posts":"novo post"),final:""};a.tarefas>0&&(l.final+=l.tarefas),a.tarefas>0&&a.posts>0&&(l.final+=" e "),a.posts>0&&(l.final+=l.posts),UI.toast.show({message:l.final,label:"Atualizar",action:function(){worker.Load(),a.tarefas=0,a.posts=0,a.total=0,$ui["page-title"].html(UI.data["page-title"]),analytics("Lista","Atualização")},persistent:!0,"start-only":!0}),$ui.title.html("("+a.total+") "+UI.data["page-title"])}a["last-updated"]=t[0]?moment(t[0].ts):moment()})},3e4)},cue["load-fonts"]=$.Deferred(),WebFont.load({timeout:15e3,google:{families:["Material Icons","Lato:400:latin"]},custom:{families:["FontAwesome"],urls:["https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"]},active:function(){cue["load-fonts"].resolve(),$(function(){app.Lista.layout()})}}),moment.locale("pt-br",{months:"janeiro_fevereiro_março_abril_maio_junho_julho_agosto_setembro_outubro_novembro_dezembro".split("_"),monthsShort:"jan_fev_mar_abr_mai_jun_jul_ago_set_out_nov_dez".split("_"),weekdays:"domingo_segunda-feira_terça-feira_quarta-feira_quinta-feira_sexta-feira_sábado".split("_"),weekdaysShort:"dom_seg_ter_qua_qui_sex_sáb".split("_"),weekdaysMin:"dom_2ª_3ª_4ª_5ª_6ª_sáb".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D [de] MMMM [de] YYYY",LLL:"D [de] MMMM [de] YYYY [às] HH:mm",LLLL:"dddd, D [de] MMMM [de] YYYY [às] HH:mm"},calendar:{sameDay:"[hoje] LT",nextDay:"[amanhã] LT",nextWeek:"dddd LT",lastDay:"[ontem] LT",lastWeek:"dddd LT",sameElse:"L"},relativeTime:{future:"daqui %s",past:"%s atrás",s:"poucos segundos",m:"um minuto",mm:"%d minutos",h:"uma hora",hh:"%d horas",d:"um dia",dd:"%d dias",M:"um mês",MM:"%d meses",y:"um ano",yy:"%d anos"},ordinalParse:/\d{1,2}º/,ordinal:"%dº"});